extends ../form-layout

block form
	include ./menu
	form.form-horizontal(method="post")
		fieldset
			legend=__("E-mails")
			#emails
			.form-group
				.col-md-10.col-md-offset-2
					button.success.add-email.btn.btn-default
						i.fa.fa-plus
						=" "
						=__("Add another E-mail")

		hr.clearfix
		.form-group
			label.col-sm-2.control-label
			.col-sm-10
				input(type="submit", value=__("Save")).btn.btn-primary.btn-lg

		script(id="email", type="text/x-handlebars-template")
			.email.form-group
				.col-md-2.control-label
					="{{#if valid}}"
					span.label.label-success=__("confirmed")
					="{{else if email}}"
					span.label.label-warning=__("not confirmed")
					="{{else}}"
					span.label.label-default=__("new, save to verify")
					="{{/if}}"
				.col-md-10
					.input-group
						="{{#if email}}"
						input.form-control(name="emails[{{i}}][email]", value="{{email}}", type="text", readonly)
						label.input-group-addon
							input(name="primary-email", type="radio", value="{{email}}")
							=" " + __("primary")
						label.input-group-addon
							input(name="emails[{{i}}][public]", type="checkbox", value="1")
							=" " + __("public")
						="{{else}}"
						input.form-control(name="emails[{{i}}][email]", value="", type="text")
						input(name="emails[{{i}}][new]", value="1", type="hidden")
						="{{/if}}"
						span.input-group-btn
							button.delete-email.btn.btn-danger
								i.fa.fa-trash

		//- FIXME
		script.
			$(document).ready(function() {
				var source   = $("#email").html();
				var template = Handlebars.compile(source);
				var data = !{JSON.stringify(result.emails)};
				var total = data.length;
				data.forEach(function(email, i) {
					email.i = i;
					$(template(email)).appendTo($('#emails'));
				});
				$(document).on('click', '.delete-email', function(ev) {
					ev.preventDefault();
					$(this).closest('.email').remove();
				});
				$(document).on('click', '.add-email', function(ev) {
					ev.preventDefault();
					$(template({i: total})).appendTo($('#emails'));
					total++;
				});
			});
