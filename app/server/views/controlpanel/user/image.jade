extends ../form-layout

block form
	include ./menu
	h2=__("image")
	if image
		img(src="#{image.file}")
	div#image(style="width:100%;height:100px;border:1px dashed;")
	div.progress
		div.progress-bar(role="progressbar", style="width: 0%;")
	script(src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js")
	script(type="text/javascript").
		$(document).ready(function() {
			drop = new Dropzone("#image", {
				paramName: "image",
				addRemoveLinks: false,
				maxFiles: 1,
				url: "/api/upload/image"
			});
			drop.on("success", function(file) {
				if (file.xhr.response) {
					$.ajax({
						type: "POST",
						url: "/controlpanel/user/image",
						data: {
							image: file.xhr.response
						},
						success: function(data) {
							if (data.success) {
								location.reload();
							} else {
								alert('error');
								location.reload();
							}
						}
					});
				} else {
					alert('error');
					location.reload();
				}
			});
			drop.on("uploadprogress", function(file, progress) {
				$('.progress-bar').css('width', progress + '%');
			});
		});
